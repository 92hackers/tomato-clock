# 番茄时钟功能设计

本文档详细描述了番茄时钟应用的功能设计和用户交互流程。

## 1. 应用结构

番茄时钟应用包含以下六个主要界面：

1. **主计时界面** - 应用的核心界面，显示计时器和当前任务
2. **设置界面** - 用于自定义应用参数和偏好
3. **成就与提示界面** - 展示用户成就和提供专注技巧
4. **统计界面** - 展示用户的使用数据和统计图表
5. **添加任务界面** - 用于创建新任务
6. **专注历程界面** - 记录用户的使用历程和进步

## 2. 功能模块详细设计

### 2.1 计时器模块

#### 功能描述

计时器是应用的核心功能，提供三种计时模式：专注时间（默认25分钟）、短休息（默认5分钟）和长休息（默认15分钟）。

#### 交互流程

1. **启动计时**
   - 用户点击"开始"按钮
   - 计时器开始倒计时
   - "开始"按钮变为"暂停"按钮

2. **暂停计时**
   - 用户点击"暂停"按钮
   - 计时器暂停倒计时
   - "暂停"按钮变回"开始"按钮

3. **重置计时**
   - 用户点击"重置"按钮
   - 计时器重置为当前模式的默认时间
   - 如果计时器正在运行，停止计时

4. **模式切换**
   - 用户点击"专注"、"短休息"或"长休息"标签
   - 计时器重置为对应模式的默认时间
   - 界面可能根据模式变化（如颜色变化）

5. **计时完成**
   - 计时结束时发出提示音或通知
   - 根据设置可能自动切换到下一个模式（如从专注切换到休息）

#### 业务规则

- 专注时间完成后，用户的当前任务完成番茄数+1
- 每完成4个专注时间段，系统推荐进行长休息
- 计时器状态在多设备间实时同步
- 支持后台计时，应用关闭时计时器继续运行

### 2.2 任务管理模块

#### 功能描述

任务管理模块允许用户创建、编辑和完成任务，并跟踪每个任务的完成进度。

#### 交互流程

1. **查看任务列表**
   - 在主界面显示当前任务列表
   - 每个任务项显示任务名称和完成进度（如"2/4"表示完成了4个番茄中的2个）

2. **添加任务**
   - 用户点击"+"按钮
   - 跳转到添加任务界面
   - 用户输入任务名称、预计番茄数和备注
   - 用户点击"保存"按钮创建任务

3. **编辑任务**
   - 用户点击任务项进入编辑模式
   - 可修改任务名称、预计番茄数、优先级等
   - 支持添加标签和设置截止日期

4. **完成番茄**
   - 当一个专注时间段完成时，当前任务的完成番茄数+1
   - 更新任务的完成进度显示

5. **完成任务**
   - 用户点击任务前的复选框
   - 任务标记为已完成
   - 已完成任务可能会被归档或移至底部

#### 业务规则

- 任务可以设置优先级（1-5级）
- 任务可以添加多个标签进行分类
- 任务可以设置截止日期
- 完成的番茄数不能超过预计番茄数（除非用户手动调整）
- 删除任务时需要确认操作

### 2.3 统计分析模块

#### 功能描述

统计分析模块收集和展示用户的使用数据，包括完成的番茄数、专注时间和完成的任务数，以帮助用户了解自己的时间使用情况。

#### 交互流程

1. **查看今日统计**
   - 在主界面底部显示今日完成的番茄数、专注分钟数和完成任务数

2. **查看详细统计**
   - 用户点击统计界面
   - 显示按周、月、年分类的统计数据
   - 提供可视化图表（如柱状图）展示数据趋势

3. **筛选统计数据**
   - 用户可以选择不同的时间范围（周、月、年）
   - 统计图表和数据随之更新

4. **热力图显示**
   - 类似GitHub的提交热力图，显示每日专注强度
   - 颜色深浅表示当日完成的番茄数

#### 统计指标

- **完成番茄数**: 用户完成的专注时间段数量
- **专注时间**: 用户实际专注的总时长
- **完成任务数**: 用户完成的任务数量
- **平均每日番茄数**: 一段时间内的日均番茄完成数
- **连续专注天数**: 用户连续使用应用的天数
- **效率评分**: 基于完成率和连续性的综合评分

### 2.4 设置模块

#### 功能描述

设置模块允许用户自定义应用的各种参数，包括计时器时间、通知和主题等。

#### 交互流程

1. **访问设置**
   - 用户点击主界面右上角的设置图标
   - 跳转到设置界面

2. **调整时间设置**
   - 用户可以修改专注时长、短休息时长和长休息时长
   - 修改后的设置立即生效

3. **通知设置**
   - 用户可以开启或关闭时间结束提醒
   - 用户可以开启或关闭休息提醒
   - 可以选择不同的提示音

4. **主题设置**
   - 用户可以选择浅色模式、深色模式或跟随系统
   - 可以选择不同的界面颜色主题

5. **自动化设置**
   - 设置是否自动开始休息时间
   - 设置是否自动开始下一个专注时间
   - 设置长休息间隔（默认每4个番茄）

#### 配置选项

- **时间配置**: 专注时长、短休息时长、长休息时长
- **通知配置**: 声音提醒、浏览器通知、震动提醒（移动端）
- **自动化配置**: 自动开始休息、自动开始专注、长休息间隔
- **界面配置**: 主题颜色、深浅模式、语言设置
- **数据配置**: 数据同步、隐私设置、导出数据

### 2.5 成就与提示模块

#### 功能描述

成就与提示模块通过游戏化元素和实用建议来激励用户持续使用番茄工作法。

#### 成就系统

1. **成就类型**
   - **入门成就**: 完成第一个番茄、创建第一个任务
   - **里程碑成就**: 完成100个番茄、连续使用7天
   - **挑战成就**: 单日完成10个番茄、一周完成50个番茄
   - **特殊成就**: 在特定时间段内完成任务、高效率完成

2. **解锁条件**
   - 完成特定数量的番茄时间
   - 连续使用应用的天数
   - 完成特定数量的任务
   - 达到特定的效率指标

3. **奖励机制**
   - 解锁成就时显示庆祝动画
   - 获得虚拟徽章和积分
   - 解锁新的界面主题或提示音

#### 专注技巧

1. **技巧分类**
   - **时间管理**: 如何更好地规划时间
   - **专注技巧**: 提高专注力的方法
   - **效率提升**: 提高工作效率的建议
   - **健康提醒**: 保护眼睛和身体健康的建议

2. **展示方式**
   - 在休息时间展示随机技巧
   - 在成就界面浏览所有技巧
   - 根据用户使用情况推荐相关技巧

### 2.6 专注历程模块

#### 功能描述

专注历程模块记录用户使用番茄时钟的重要里程碑和进步情况，帮助用户了解自己在时间管理方面的成长。

#### 功能特性

1. **学习曲线**
   - 显示用户在专注能力、持续性和效率提升方面的进度
   - 用进度条和百分比展示各项能力的发展

2. **历程记录**
   - 记录重要的里程碑事件
   - 以时间轴形式展示用户的成长历程
   - 包括第一次使用、重要成就、连续使用记录等

3. **进步分析**
   - 分析用户的使用模式和改进趋势
   - 提供个性化的建议和鼓励
   - 预测用户可能达到的下一个里程碑

#### 评估指标

- **专注能力**: 基于单次专注时长和完成率
- **持续性**: 基于连续使用天数和频率
- **效率评分**: 基于任务完成率和时间利用率
- **改进趋势**: 各项指标的变化趋势

### 2.7 用户认证模块

#### 功能描述

用户认证模块为番茄时钟应用提供完整的用户账户管理功能，包括用户注册、登录、登出和权限控制。该模块采用安全的认证机制，确保用户数据的隐私和安全。

#### 核心功能

1. **用户注册**
   - 邮箱和密码注册
   - 实时表单验证
   - 密码强度检查
   - 服务条款同意机制

2. **用户登录**
   - 邮箱/密码登录
   - 记住登录状态
   - 自动重定向到原访问页面
   - 错误处理和用户友好提示

3. **会话管理**
   - 自动登录状态检查
   - 会话过期处理
   - 跨设备状态同步
   - 安全登出

4. **权限控制**
   - 受保护路由系统
   - 角色权限管理
   - 未授权访问自动重定向

#### 交互流程

1. **用户注册流程**
   - 用户访问注册页面
   - 填写注册表单（用户名、邮箱、密码、确认密码）
   - 系统进行实时表单验证
   - 用户阅读并同意服务条款
   - 提交注册信息
   - 系统验证数据并创建账户
   - 注册成功后自动登录并跳转到主界面

2. **用户登录流程**
   - 用户访问登录页面
   - 输入邮箱和密码
   - 系统验证凭据
   - 登录成功后创建会话
   - 跳转到原访问页面或默认主界面

3. **会话恢复流程**
   - 用户访问应用
   - 系统检查本地存储的认证令牌
   - 验证令牌有效性
   - 自动恢复登录状态
   - 如令牌过期，重定向到登录页面

4. **权限检查流程**
   - 用户访问受保护页面
   - 系统检查用户认证状态
   - 如未认证，重定向到登录页面并保存原访问路径
   - 如已认证，检查用户权限
   - 权限不足时显示相应提示

#### 安全特性

1. **密码安全**
   - 密码强度验证（长度、复杂性要求）
   - 安全的密码哈希存储
   - 防止暴力破解攻击

2. **会话安全**
   - 基于 Cookie 的会话管理
   - 会话过期机制
   - 安全的会话存储
   - CSRF防护

3. **数据保护**
   - 敏感数据加密
   - 安全的HTTP传输
   - 用户隐私保护

#### 用户体验设计

1. **登录界面**
   - 简洁优雅的iOS风格设计
   - 清晰的表单标签和错误提示
   - 加载状态指示器
   - 响应式布局适配

2. **注册界面**
   - 分步骤的注册流程
   - 实时验证反馈
   - 密码强度指示器
   - 服务条款链接

3. **用户反馈**
   - 友好的错误提示信息
   - 成功操作确认
   - 加载状态可视化
   - 网络错误处理

#### 技术实现

1. **前端认证**
   - React Hook Form表单处理
   - Zustand状态管理
   - 自定义表单验证规则
   - 路由保护组件

2. **后端集成**
   - RESTful API设计
   - 基于 Cookie 的会话管理
   - 安全的密码处理
   - 会话管理

3. **数据流设计**
   - 客户端状态管理
   - 服务端状态同步
   - 错误边界处理
   - 自动重试机制

#### 测试覆盖

1. **功能测试**
   - 注册流程测试
   - 登录流程测试
   - 权限控制测试
   - 错误处理测试

2. **用户体验测试**
   - 表单验证测试
   - 无障碍访问测试
   - 移动端适配测试
   - 键盘导航测试

3. **安全测试**
   - 输入验证测试
   - 权限控制测试
   - 会话管理测试
   - 错误场景测试

#### 业务规则

- 用户名必须唯一且符合规范
- 邮箱地址必须有效且未被注册
- 密码必须满足安全强度要求
- 会话令牌有效期为7天
- 未认证用户只能访问公开页面
- 注册时必须同意服务条款
- 连续登录失败将暂时锁定账户

## 3. 用户体验设计原则

### 3.1 简洁性原则

- 界面设计简洁明了，突出核心功能
- 减少不必要的操作步骤
- 使用直观的图标和文字说明

### 3.2 一致性原则

- 保持整个应用的设计风格一致
- 相同功能的操作方式保持一致
- 颜色、字体、图标使用规范统一

### 3.3 反馈性原则

- 用户操作后及时提供反馈
- 使用适当的动画和提示音
- 错误操作时提供明确的错误信息

### 3.4 可访问性原则

- 支持键盘操作
- 提供适当的颜色对比度
- 支持屏幕阅读器
- 提供多语言支持

## 4. 数据同步与离线支持

### 4.1 数据同步

- **单用户多设备同步**: 用户在不同设备上的数据自动保持一致
- **实时状态同步**: 计时器状态、任务进度在所有设备间实时更新
- **自动数据备份**: 数据变更自动保存到云端
- **断网续传**: 网络恢复后自动同步离线期间的数据变更

### 4.2 离线支持

- **核心功能离线可用**: 计时器、任务管理在无网络时正常工作
- **本地数据存储**: 离线期间的所有操作本地保存
- **智能同步**: 连网后自动合并本地和云端数据
- **冲突解决**: 数据冲突时优先使用最新的操作时间

## 5. 实时通信系统设计

### 5.1 Socket.IO 架构概述

应用采用 Socket.IO 实现单用户多设备间的实时数据同步，确保用户在不同设备上的体验一致性。

#### 设计原则
- **单用户数据同步**: 专注于个人数据在多设备间的同步，无需复杂的多用户通信
- **简化架构**: 避免过度设计，专注核心功能实现
- **可靠性优先**: 确保数据同步的准确性和一致性
- **自动重连**: 网络中断后自动恢复连接和数据同步

### 5.2 实时同步功能设计

#### 5.2.1 计时器状态同步

- **同步内容**: 计时器当前状态、剩余时间、运行模式
- **触发时机**: 计时器开始、暂停、重置、完成时
- **同步策略**: 服务端维护权威状态，客户端请求同步

**用户场景**:
> 用户在电脑上开始一个25分钟的专注计时，然后走到另一个房间用手机查看，手机上立即显示正确的剩余时间和运行状态。

#### 5.2.2 任务数据同步

- **同步内容**: 任务列表变更、任务完成状态、番茄完成数
- **触发时机**: 添加、编辑、删除、完成任务时
- **同步策略**: 增量同步，只传输变更的数据

**用户场景**:
> 用户在手机上添加一个新任务，回到电脑前时任务列表已经自动更新，无需手动刷新。

#### 5.2.3 成就解锁同步

- **同步内容**: 新解锁的成就、进度更新
- **触发时机**: 达成成就条件时
- **同步策略**: 实时推送通知到所有设备

**用户场景**:
> 用户完成第100个番茄后解锁里程碑成就，所有设备同时显示成就解锁的庆祝动画。

### 5.3 连接管理设计

#### 5.3.1 身份认证
- **基于 Session**: 利用现有的 Cookie Session 认证
- **连接验证**: Socket.IO 连接时验证用户身份
- **自动授权**: 认证成功后自动加入用户专属同步范围

#### 5.3.2 连接生命周期

1. **连接建立**
   - 用户登录后自动建立 Socket.IO 连接
   - 验证用户身份并获取最新数据状态
   - 发送初始数据同步

2. **数据同步**
   - 监听用户的数据变更事件
   - 实时推送变更到用户的其他设备
   - 处理同步请求和心跳检测

3. **连接中断处理**
   - 自动重连机制
   - 重连后请求增量同步
   - 离线期间数据暂存到本地

4. **连接清理**
   - 用户登出时主动断开连接
   - 服务端清理连接相关资源

### 5.4 事件设计

#### 5.4.1 客户端发送事件

```typescript
// 数据同步请求
emit('sync_request') -> 请求完整数据同步

// 心跳检测
emit('ping') -> 保持连接活跃
```

#### 5.4.2 服务端推送事件

```typescript
// 计时器状态同步
on('timer_sync', data: TimerSyncData) -> 计时器状态变更

// 任务数据同步  
on('task_sync', data: TaskSyncData) -> 任务列表变更

// 成就解锁通知
on('achievement_unlocked', data: AchievementData) -> 新成就解锁

// 连接状态
on('connected') -> 连接成功确认
on('error', data: ErrorData) -> 错误信息通知
```

### 5.5 数据一致性保证

#### 5.5.1 冲突解决策略

- **时间戳优先**: 以最后修改时间为准
- **操作优先级**: 某些操作具有更高优先级（如任务完成）
- **用户确认**: 复杂冲突时提示用户选择

#### 5.5.2 数据完整性

- **增量同步**: 只同步变更部分，减少数据传输
- **校验机制**: 定期校验数据一致性
- **恢复机制**: 数据异常时触发完整同步

### 5.6 性能优化设计

#### 5.6.1 连接优化

- **连接复用**: 同一用户多标签页共享连接
- **智能重连**: 指数退避重连策略
- **心跳优化**: 根据网络状况调整心跳间隔

#### 5.6.2 数据传输优化

- **数据压缩**: 启用 Socket.IO 数据压缩
- **批量更新**: 短时间内多次变更合并发送
- **按需同步**: 只同步用户当前关注的数据

### 5.7 用户体验设计

#### 5.7.1 连接状态提示

- **连接正常**: 无特殊提示，保持界面简洁
- **连接中断**: 顶部显示黄色连接状态条
- **重连中**: 显示重连动画和进度
- **连接失败**: 显示错误信息和手动重连按钮

#### 5.7.2 同步反馈

- **同步成功**: 数据变更后立即在界面上体现
- **同步延迟**: 超过预期时间显示同步状态
- **同步失败**: 显示重试选项和离线模式提示

### 5.8 故障处理

#### 5.8.1 网络异常

- **自动降级**: 网络异常时切换到离线模式
- **数据暂存**: 离线操作暂存到本地存储
- **恢复同步**: 网络恢复后自动同步离线数据

#### 5.8.2 服务异常

- **服务降级**: Socket.IO 服务异常时使用 HTTP 轮询
- **数据保护**: 确保本地数据不因同步异常而丢失
- **错误上报**: 记录异常信息便于问题排查

通过这套完整的实时通信系统设计，用户可以享受到真正无缝的多设备体验，无论在哪个设备上操作，其他设备都能实时响应和同步，大大提升了番茄时钟应用的实用性和用户体验。

## 6. 性能要求

### 6.1 响应性能

- 界面操作响应时间 < 100ms
- 页面加载时间 < 3秒
- 数据同步延迟 < 1秒

### 6.2 兼容性

- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端浏览器
- 响应式设计适配不同屏幕尺寸

### 6.3 稳定性

- 应用运行稳定，无频繁崩溃
- 数据存储可靠，无数据丢失
- 异常情况下能优雅降级

通过这套完整的功能设计，番茄时钟应用将为用户提供一个简洁、高效、有趣的时间管理工具，帮助用户养成良好的工作和学习习惯。 